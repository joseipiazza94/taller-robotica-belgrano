---
const pilares = [
  { 
    id: 'quienes', 
    titulo: 'Quiénes Somos', 
    resumen: 'El equipo detrás de la innovación en Salta.', 
    detalle: 'Somos un grupo interdisciplinario de docentes y profesionales apasionados por la tecnología aplicada a la educación. En el Colegio Belgrano, nuestra misión es brindar un entorno donde la curiosidad se transforme en proyectos reales.\n\nContamos con especialistas en ingeniería, programación y pedagogía que acompañan a cada alumno en su proceso de descubrimiento técnico.' 
  },
  { 
    id: 'que', 
    titulo: 'Qué Hacemos', 
    resumen: 'Robótica educativa y experimentación real.', 
    detalle: 'Desde la construcción física con kits especializados hasta el desarrollo de algoritmos de inteligencia artificial. Nuestro taller abarca:\n\n• Diseño y prototipado mecánico.\n• Programación en entornos visuales y de código.\n• Preparación para competencias nacionales e internacionales.\n• Electrónica y automatización avanzada.' 
  },
  { 
    id: 'porque', 
    titulo: 'Por Qué', 
    resumen: 'Crear tecnología, no solo consumirla.', 
    detalle: 'Vivimos en un mundo rodeado de dispositivos, pero pocos entienden su lenguaje. El objetivo de este taller es empoderar a los chicos para que dejen de ser usuarios pasivos y se conviertan en los creadores del mañana.\n\nFomentamos el pensamiento crítico, la resolución de problemas complejos y la resiliencia ante el error.' 
  },
  { 
    id: 'como', 
    titulo: 'Cómo', 
    resumen: 'Metodología basada en proyectos y niveles.', 
    detalle: 'Nuestro camino de aprendizaje está estructurado en tres niveles de progresión técnica diseñados para acompañar el crecimiento cognitivo del alumno:',
    niveles: [
      { nombre: 'Spark Squad', desc: 'Mecánica y bloques (Nivel Inicial)' },
      { nombre: 'Circuit Masters', desc: 'Arduino y 3D (Nivel Intermedio)' },
      { nombre: 'Cyber Builders', desc: 'Competición y Python (Nivel Avanzado)' }
    ]
  },
];
---

<section class="pilares-section">
  <div class="pilares-grid" id="pilaresGrid">
    {pilares.map(pilar => (
      <div class="pilar-card" data-id={pilar.id}>
        
        {/* PESTAÑA DE SALIDA VERTICAL */}
        <button class="close-tab" aria-label="Cerrar pilar">
          <span>CERRAR</span>
        </button>

        {/* VISTA CERRADA (Bordó) */}
        <div class="pilar-closed">
          <div class="placeholder-svg-closed"></div>
          <h2>{pilar.titulo}</h2>
          <p class="summary-text">{pilar.resumen}</p>
        </div>
        
        {/* VISTA ABIERTA (Gris Industrial) */}
        <div class="pilar-opened">
          <div class="content-wrapper">
            <div class="header-box">
              <h3>{pilar.titulo}</h3>
            </div>
            
            <div class="detail-grid">
              <div class="text-detail">
                <div class="scrollable-content">
                  <p class="lead-text">{pilar.resumen}</p>
                  <div class="full-body-text">
                    {pilar.detalle}
                  </div>
                  
                  {pilar.niveles && (
                    <div class="mini-niveles">
                      {pilar.niveles.map(n => (
                        <div class="mini-card">
                          <strong>{n.nombre}</strong>
                          <span>{n.desc}</span>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
                
                <div class="action-footer">
                  <a href={`/pilares/${pilar.id}`} class="btn-more">LEER MÁS DETALLADO →</a>
                </div>
              </div>

              <div class="image-placeholder">
                <div class="placeholder-overlay">
                  <span>[ ESPACIO PARA FOTO O INFOGRAFÍA ]</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    ))}
  </div>
</section>

<style>
  .pilares-section { 
    background: #121212; 
    padding: 2rem 0; 
    min-height: auto; 
    display: flex; 
    overflow: hidden; 
  }

  .pilares-grid { 
    display: grid; 
    grid-template-columns: 1fr 1fr; 
    grid-template-rows: 1fr 1fr; 
    width: 100vw; 
    height: 85vh; /* Altura reducida para que no sea tan alto */
    transition: all 0.8s cubic-bezier(0.85, 0, 0.15, 1); 
  }

  /* Expansiones GIGANTES */
  .pilares-grid.expanded-quienes { grid-template-columns: 4fr 1fr; grid-template-rows: 4fr 1fr; }
  .pilares-grid.expanded-que     { grid-template-columns: 1fr 4fr; grid-template-rows: 4fr 1fr; }
  .pilares-grid.expanded-porque  { grid-template-columns: 4fr 1fr; grid-template-rows: 1fr 4fr; }
  .pilares-grid.expanded-como    { grid-template-columns: 1fr 4fr; grid-template-rows: 1fr 4fr; }

  .pilar-card { 
    background: #8b1d20; 
    color: white; 
    cursor: pointer; 
    position: relative; 
    overflow: hidden; 
    border: 1px solid rgba(255,255,255,0.05); 
    transition: background 0.6s ease; 
  }

  .pilar-card.is-active { 
    background: #1e1e1e; /* Gris Industrial */
    cursor: default; 
    z-index: 10; 
  }

  /* PESTAÑA DE SALIDA */
  .close-tab {
    position: absolute;
    background: #d83135; /* Rojo oficial */
    color: white;
    border: none;
    width: 40px;
    height: 150px;
    cursor: pointer;
    z-index: 50;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: all 0.5s cubic-bezier(0.22, 1, 0.36, 1);
  }

  [data-id="quienes"] .close-tab { bottom: 0; right: 0; transform: translateX(100%); }
  [data-id="que"] .close-tab     { bottom: 0; left: 0; transform: translateX(-100%); }
  [data-id="porque"] .close-tab  { top: 0; right: 0; transform: translateX(100%); }
  [data-id="como"] .close-tab    { top: 0; left: 0; transform: translateX(-100%); }

  .pilar-card.is-active .close-tab { opacity: 1; transform: translateX(0); }
  .close-tab span { writing-mode: vertical-rl; text-orientation: mixed; font-weight: 900; letter-spacing: 2px; font-size: 0.8rem; }
  .close-tab:hover { background: white; color: #d83135; }

  /* VISTA CERRADA */
  .pilar-closed { 
    display: flex; flex-direction: column; align-items: center; justify-content: center; 
    height: 100%; padding: 1.5rem; text-align: center; transition: opacity 0.4s;
  }
  .pilar-card.is-active .pilar-closed { opacity: 0; pointer-events: none; }
  
  .pilar-closed h2 { font-size: 2.2rem; font-weight: 900; text-transform: uppercase; }
  .summary-text { opacity: 0.6; max-width: 250px; margin-top: 0.5rem; font-size: 0.9rem; }
  .placeholder-svg-closed { width: 40px; height: 40px; background: rgba(255,255,255,0.1); border-radius: 50%; margin-bottom: 1rem; }

  /* VISTA ABIERTA */
  .pilar-opened { 
    display: none; padding: 4% 6%; height: 100%; opacity: 0; 
    position: absolute; top: 0; left: 0; width: 100%;
  }
  .pilar-card.is-active .pilar-opened { display: block; animation: fadeIn 0.6s forwards 0.4s; }

  .content-wrapper { height: 100%; display: flex; flex-direction: column; }
  .content-wrapper h3 { font-size: clamp(3rem, 6vw, 5rem); font-weight: 900; text-transform: uppercase; color: #d83135; margin-bottom: 1.5rem; }

  .detail-grid { display: grid; grid-template-columns: 1.2fr 1fr; gap: 4rem; flex: 1; min-height: 0; }
  
  .text-detail { display: flex; flex-direction: column; }
  
  .scrollable-content { 
    overflow-y: auto; flex: 1; padding-right: 1.5rem; 
    scrollbar-width: thin; scrollbar-color: #d83135 transparent;
  }
  
  .scrollable-content::-webkit-scrollbar { width: 4px; }
  .scrollable-content::-webkit-scrollbar-thumb { background: #d83135; }

  .lead-text { font-size: 1.6rem; font-weight: 700; color: #d83135; margin-bottom: 1.5rem; line-height: 1.2; }
  .full-body-text { font-size: 1.1rem; line-height: 1.5; color: #e0e0e0; white-space: pre-line; }

  .mini-niveles { display: grid; gap: 0.8rem; margin: 1.5rem 0; }
  .mini-card { background: rgba(255,255,255,0.03); padding: 1rem; border-left: 4px solid #d83135; }
  .mini-card strong { display: block; color: white; margin-bottom: 0.2rem; }
  .mini-card span { color: #888; font-size: 0.85rem; }

  .action-footer { margin-top: 1.5rem; }
  .btn-more { 
    display: inline-block; padding: 1rem 2rem; 
    background: white; color: #121212; text-decoration: none; font-weight: 900; 
  }

  .image-placeholder { background: #252525; border: 1px dashed #444; position: relative; }
  .placeholder-overlay { display: flex; align-items: center; justify-content: center; height: 100%; color: #555; text-align: center; padding: 2rem; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  @media (max-width: 1024px) {
    .pilares-grid { grid-template-columns: 1fr; grid-template-rows: repeat(4, 1fr); height: auto; }
    .content-wrapper h3 { font-size: 2.2rem; }
    .detail-grid { grid-template-columns: 1fr; }
    .close-tab { width: 100%; height: 40px; top: 0 !important; left: 0 !important; transform: translateY(-100%) !important; }
    .pilar-card.is-active .close-tab { transform: translateY(0) !important; }
    .close-tab span { writing-mode: horizontal-tb; }
    .scrollable-content { overflow-y: visible; max-height: none; }
  }
</style>

<script>
  const setupPilares = () => {
    const grid = document.getElementById('pilaresGrid');
    const cards = document.querySelectorAll('.pilar-card');

    cards.forEach(card => {
      card.addEventListener('click', (e) => {
        const id = card.getAttribute('data-id');
        const target = e.target as HTMLElement;

        if (target.closest('.close-tab')) {
          grid?.setAttribute('class', 'pilares-grid');
          cards.forEach(c => c.classList.remove('is-active'));
          e.stopPropagation();
          return;
        }

        if (!card.classList.contains('is-active')) {
          cards.forEach(c => c.classList.remove('is-active'));
          card.classList.add('is-active');
          grid?.setAttribute('class', `pilares-grid expanded-${id} is-any-active`);
        }
      });
    });
  };

  setupPilares();
  document.addEventListener('astro:page-load', setupPilares);
</script>